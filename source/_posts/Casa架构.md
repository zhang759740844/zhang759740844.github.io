title: 读 Casa 应用架构的一些笔记
date: 2017/5/13 10:07:12  
categories: iOS
tags:
	- 架构
---

读了 Casa 的一系列架构的文章 [Archives for Casa Taloyum](https://casatwy.com/archives.html)，自己再总结消化一下。

<!--more-->



## 开篇

### 什么样才是好架构

#### 代码整齐，分类明确，没有 common，没有 core

不要让一个类或者一个模块做两种不同的事情（单一职责原则）。一方面不适合未来拓展，另一方面会造成分类困难。

不要搞 Common，Core 这些东西。迭代多了会越来越大。如果有什么东西特别小，索性单独开辟一个模块就行了。原因如下：

1. Common 里容易形成错综复杂的小模块依赖，会纵容工程师不注意依赖的管理，以至于未来想拆分的时候，会很困难。
2. Common 与细粒度模块的设计思想背道而驰，属于偷懒的手段。
3. 每次迭代都会把不好分类的东西放在 Common，给维护 Common 的人带来大的工作量，容易出错。



#### 很少文档就能让业务方上手

尽可能将 API 命名的可读性强一些。比如：

1. 不要直接返回 `id` 或者传入 `id`，实在不行，用 `id<protocol>` 也比 `id` 好。
2. 要告知也无妨传什么。比如要传 `Image`，就要写上 `ofImage` ，要传位置，既要写上 `IndexPath` ，而不是 `position` 这种笼统的命名。
3. 没有必要传 `delegate`，`delegate` 可以作为属性赋值。



#### 没有横向依赖，万不得已不要跨层访问

横向依赖就是在某一分层中的各模块间的相互依赖的描述。在架构图上如果画出依赖关系，就可以看到他们是横着的，所以叫横向依赖。纵向依赖就是上层依赖下层。

跨层访问是指数据流向了跟自己没有对接关系的模块。跨层访问同样增加耦合度，当某一层需要整体替换的时候，牵涉面就会很大。

#### 接口少，接口参数少

越少的接口和越少的参数，就能降低业务方的使用成本。需要在满足条件的前提下，减少接口和参数。

要达到一个功能的最少传参，多的参数没有必要性，还容易产生耦合。



### Q&A

依赖关系都是上层依赖下层，因为下层为上层提供服务。

不要使用 pch，也最好不要专门添加一个头文件 import 所有要用到的类。在你的类中，需要使用到哪个就 import 哪个。

category 理想的拆分是按照被 category 的对象拆分成 pod。string 就 string 一个 pod，uiview 就 uiview 一个 pod，然后用刀哪个就引用哪个 pod，pod 多一点没有问题。如果单个 pod 很大，还可以根据业务继续拆。

可以通过 cocoapods 封装组件，将每个 SDK 及其对应的再封装的代码放到同一个 repo 里去。也可以通过 cocoapods 专门管理一个图片 repo，然后根据模块分文件夹来管理，每次添加图片的时候都去看一下这个 repo 里是不是已经有这个图片了。



## View 层组织和调用方案











