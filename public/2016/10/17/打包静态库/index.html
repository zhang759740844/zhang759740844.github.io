<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Xcode," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="最近由于要接入第三方库，因此想要了解库的相关知识。网上查阅了许多资料，仍然比较疑惑。比如，静态库能否以及如何引入动态库？动态库能否以及如何引入静态库？自建动态库(非系统动态库)的好处体现在哪，怎么实现？等等。在一番探索之后，总结了一篇较为详尽全面的库的使用方法。">
<meta property="og:type" content="article">
<meta property="og:title" content="ios中库的介绍与使用">
<meta property="og:url" content="http://zhang759740844.github.io/2016/10/17/打包静态库/index.html">
<meta property="og:site_name" content="Zachary's blog">
<meta property="og:description" content="最近由于要接入第三方库，因此想要了解库的相关知识。网上查阅了许多资料，仍然比较疑惑。比如，静态库能否以及如何引入动态库？动态库能否以及如何引入静态库？自建动态库(非系统动态库)的好处体现在哪，怎么实现？等等。在一番探索之后，总结了一篇较为详尽全面的库的使用方法。">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/库.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_1.jpg?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_2.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_3.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_4.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_5.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_6.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_7.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_8.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_9.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_10.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_11.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_12.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_13.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_14.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_15.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_1.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_2.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_3.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_4.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_5.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_6.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_7.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_8.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_4.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_1.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_2.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_3.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_5.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_1.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_2.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_3.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_4.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_5.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_6.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_7.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_9.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_8.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_1.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_2.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_3.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_4.png?raw=true">
<meta property="og:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_5.png?raw=true">
<meta property="og:updated_time" content="2017-01-16T04:26:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ios中库的介绍与使用">
<meta name="twitter:description" content="最近由于要接入第三方库，因此想要了解库的相关知识。网上查阅了许多资料，仍然比较疑惑。比如，静态库能否以及如何引入动态库？动态库能否以及如何引入静态库？自建动态库(非系统动态库)的好处体现在哪，怎么实现？等等。在一番探索之后，总结了一篇较为详尽全面的库的使用方法。">
<meta name="twitter:image" content="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/库.png?raw=true">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://zhang759740844.github.io/2016/10/17/打包静态库/"/>

  <title> ios中库的介绍与使用 | Zachary's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Zachary's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">记录成长</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                ios中库的介绍与使用
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-17T10:07:12+08:00" content="2016-10-17">
              2016-10-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>最近由于要接入第三方库，因此想要了解库的相关知识。网上查阅了许多资料，仍然比较疑惑。比如，静态库能否以及如何引入动态库？动态库能否以及如何引入静态库？自建动态库(非系统动态库)的好处体现在哪，怎么实现？等等。在一番探索之后，总结了一篇较为详尽全面的库的使用方法。</p>
<a id="more"></a>
<p>先来看一张思维导图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/库.png?raw=true" alt="库"></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="什么是库"><a href="#什么是库" class="headerlink" title="什么是库"></a>什么是库</h3><p>库是共享程序代码的方式。库从本质上来说是一种可执行代码的二进制格式，可以被载入内存中执行。在开发过程中，一些核心技术或者常用框架，出于安全性和稳定性的考虑，不想被外界知道，所以会把核心代码打包成库，只暴露出头文件以供使用。库分静态库和动态库两种。</p>
<h3 id="库的分类"><a href="#库的分类" class="headerlink" title="库的分类"></a>库的分类</h3><h4 id="静态库"><a href="#静态库" class="headerlink" title="静态库"></a>静态库</h4><p>存在 <code>.a</code> 和 <code>.framework</code> 两种形式。 <code>.a</code> 是一个纯二进制文件，<code>.framework</code> 中除了有二进制文件之外还有资源文件。 <code>.a</code> ，要有 <code>.h</code> 文件以及资源文件配合， <code>.framework</code> 文件可以直接使用。总的来说，<code>.a + .h + sourceFile = .framework</code>。所以创建静态库最好还是用<code>.framework</code>的形式。</p>
<p>对于静态库而言，类似于一个编译好的 <code>.o</code> 的集合。在build的过程中，只会参与链接的操作，链接器会将静态库中被使用的部分合并到可执行文件中去，用函数的实际地址来代替函数引用。链接流程如下图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_1.jpg?raw=true" alt="静态库的链接过程"></p>
<h4 id="动态库"><a href="#动态库" class="headerlink" title="动态库"></a>动态库</h4><p>存在<code>.framework</code>和<code>.tbd</code>两种形式。</p>
<p>在 iOS8 之前，苹果不允许第三方框架使用动态方式加载，从 iOS8 开始允许开发者有条件地创建和使用动态框架，这种框架叫做 Cocoa Touch Framework。虽然同样是动态框架，但是和系统 framework 不同，app 中的使用的 Cocoa Touch Framework 在打包和提交 app 时会被放到 app bundle 中，运行在沙盒里，而不是系统中。也就是说，不同的 app 就算使用了同样的 framework，但还是会有多份的框架被分别签名，打包和加载。不过 iOS8 上开放了 <strong>App Extension</strong> 功能，可以为一个应用创建插件，这样主app和插件之间共享动态库还是可行的。</p>
<p>动态链接是使用了 <strong>Procedure Linkage Table (PLT)</strong>。首先这个 <strong>PLT</strong> 列出了程序中每一个函数的调用，<strong>当程序开始运行</strong>，如果动态库被加载到内存中，<strong>PLT</strong> 会去寻找动态的地址并记录下来，如果函数被调用过的话，下一次调用就可以通过 <strong>PLT</strong> 直接跳转了。</p>
<h3 id="优劣"><a href="#优劣" class="headerlink" title="优劣"></a>优劣</h3><p>静态库，在链接时会被完整地复制到可执行文件中，被多次使用就有多份冗余拷贝。<br>好处很明显，编译完成之后，库文件实际上就没有作用了。目标程序没有外部依赖，直接就可以运行。当然其缺点也很明显，就是会使用目标程序的体积增大。</p>
<p>动态库，与静态库相反，动态库在编译时并不会被拷贝到目标程序中，目标程序中只会存储指向动态库的引用。等到程序运行时，动态库才会被真正加载进来。<br>系统的动态库不需要拷贝到目标程序中，自建的动态库可以由工程内的多个库共享，因此可以减小目标程序的体积。但是，由于其把静态链接做的事情都搬到运行时来做，程序的启动会变慢。</p>
<h2 id="库的创建"><a href="#库的创建" class="headerlink" title="库的创建"></a>库的创建</h2><h3 id="a静态库的创建"><a href="#a静态库的创建" class="headerlink" title=".a静态库的创建"></a>.a静态库的创建</h3><p>创建一个 <code>.a</code> 静态库项目，如下图所示：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_2.png?raw=true" alt="lib_2"><br>静态库的文件列表如下，在 <strong>products</strong> 文件夹内的就是要生成的静态库。此刻是红色的，等到生成成功就会变成黑色。<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_3.png?raw=true" alt="lib_3"><br>现在新建自己的类<code>PrintString.h</code>，声明和实现一个第三方库的方法。<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_4.png?raw=true" alt="lib_4"><br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_5.png?raw=true" alt="lib_5"><br>现在可以打包这个静态库了。由于模拟器和真机架构不同，需要选择该包将运行在哪个环境下，如下图所示，选择运行在真机上：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_6.png?raw=true" alt="lib_6"><br>打包生成了静态库在 <strong>products</strong> 文件夹内：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_7.png?raw=true" alt="lib_7"><br>打开 <strong>products</strong> 文件夹， 但是此时暴露出来的头文件并没有<code>PrintString.h</code>。需要对暴露的头文件进行设置。<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_8.png?raw=true" alt="lib_8"><br>如下图，在 <strong>Build Phase</strong> ，的 <strong>Copy Files</strong> 目录下加入想要公开的头文件：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_9.png?raw=true" alt="lib_9"><br>现在再 run 一次，就得到了正确的静态库。<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_10.png?raw=true" alt="lib_10"><br>现在，可以测试一下这个静态库。可以再创建一个工程，把库拖进去。不过更推荐如下图所示，新建一个 <strong>target</strong> ：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_11.png?raw=true" alt="lib_11"><br>先要在工程和库间建立关联。如下图所示，在 <strong>Link Binary With Libraries</strong> 中添加库：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_12.png?raw=true" alt="lib_12"><br>在 <code>ViewController.m</code> 中调用库的方法：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_13.png?raw=true" alt="lib_13"><br>现在可以运行了，不过运行前要选择对 <strong>target</strong> ：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_14.png?raw=true" alt="lib_14"><br>可以在控制台看到库中的方法被调用了：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/lib_15.png?raw=true" alt="lib_15"></p>
<h3 id="framework的创建"><a href="#framework的创建" class="headerlink" title=".framework的创建"></a>.framework的创建</h3><h4 id="动态framework"><a href="#动态framework" class="headerlink" title="动态framework"></a>动态framework</h4><p>创建一个framework：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_1.png?raw=true" alt="frame_1"><br>创建后的文件列表如下，可以看到只有一个 <code>framework.h</code> 头文件。通过注释，我们可以理解，这个头文件是所有 public 头文件的集合：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_2.png?raw=true" alt="frame_2"><br>将前面创建的 <code>PrintString.h</code> 和 <code>PrintString.m</code> 导入，并且 import 到 <code>framework.h</code> 中去：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_3.png?raw=true" alt="frame_3"><br>设置需要暴露的头文件，头文件默认在 <strong>project header</strong> 中，将需要暴露出来的拖到 <strong>public header</strong> 中去。<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_4.png?raw=true" alt="frame_4"><br>我们可以看到此处有三种头文件，分别是 <strong>project header</strong> ， <strong>public header</strong> ， <strong>private header</strong> 。区别如下：</p>
<blockquote>
<p>Public: The interface is finalized and meant to be used by your product’s clients. A public header is included in the product as readable source code without restriction.</p>
<p>Private: The interface isn’t intended for your clients or it’s in early stages of development. A private header is included in the product, but it’s marked “private”. Thus the symbols are visible to all clients, but clients should understand that they’re not supposed to use them.</p>
<p>Project: The interface is for use only by implementation files in the current project. A project header is not included in the target, except in object code. The symbols are not visible to clients at all, only to you.</p>
</blockquote>
<p>生成的 framework 文件目录如下：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_5.png?raw=true" alt="frame_5"></p>
<p>将生成的 framework 放入工程中测试，编译通过，运行时出现如下错误：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_6.png?raw=true" alt="frame_6"></p>
<p>需要将动态库嵌入工程的 bundle 中。因此，需要在 General 中的 <strong>Embedded Binary</strong> 一项中加入相应动态库：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_7.png?raw=true" alt="frame_7"></p>
<p>现在就可以正确运行了</p>
<h4 id="静态framework"><a href="#静态framework" class="headerlink" title="静态framework"></a>静态framework</h4><p>静态framework和动态framework创建的基本流程一致，唯一的区别需要设置 <strong>Mach-O Type</strong> 为 <code>Static Library</code> ：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/fram_8.png?raw=true" alt="frame_8"></p>
<h3 id="静态库与动态库的引用"><a href="#静态库与动态库的引用" class="headerlink" title="静态库与动态库的引用"></a>静态库与动态库的引用</h3><p>一个库的开发经常会需要用到其他的库(如 <code>AFNetWorking</code> )的配合，因此，需要在库中嵌入其他的库。如何在自己的静态/动态库中集成第三方的静态/动态库是我比较困惑的点。</p>
<p><em>网上没有找到相关教程，以下是我不断尝试后得出的结论，如果有错误还请指正。</em></p>
<h4 id="动态库引用静态库"><a href="#动态库引用静态库" class="headerlink" title="动态库引用静态库"></a>动态库引用静态库</h4><p>创建一个动态库 <code>DynamicWithStatic</code>。</p>
<p>使用 <strong>cocoapods</strong> 的方式为动态库引入静态库。在工程目录下新建 <code>podfile</code>,写入:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">target <span class="string">'DynamicWithStatic'</span> <span class="keyword">do</span></div><div class="line">pod <span class="string">'SVProgressHUD'</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这里引入<code>SVProgressHUD</code>，因为调试起来比较简单。</p>
<p>在执行完 <code>pod install</code> 后，打开 <code>Frameworks.xcworkspace</code> ,在其中添加<code>SVProgress</code>类。现在的工程目录如下：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_4.png?raw=true" alt="动静库引用"></p>
<hr>
<p><strong>关于 <code>pod install</code> 慢的方法</strong><br>这里插一下，<code>pod</code> 的时候经常会卡在一个包上，会让人以为没有下载速度了。可以通过添加选项 <code>pod install --verbose</code> 的方式，看到安装详情，可以看到速度已经估计时间，这样心里就有数了。</p>
<hr>
<p>在<code>SVProgress.h</code>中添加代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SVProgresshud)();</div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SVProgress</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line">+ (SVProgresshud)getBlock;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>在<code>SVProgress.m</code>中添加代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"SVProgress.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"SVProgressHUD.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SVProgress</span></span></div><div class="line">+(SVProgresshud)getBlock&#123;</div><div class="line">    <span class="keyword">return</span> ^()&#123;</div><div class="line">        [SVProgressHUD showSuccessWithStatus:<span class="string">@"成功！"</span>];</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><code>SVProgress</code>类的目的是提供一个 block 以供调用。将 <code>SVProgress.h</code> 头文件暴露出来后， run 生成动态库。</p>
<p>动态库内引用静态库相当于直接把代码写入动态库中，非常的简单。现在思考一个问题，如果工程中引用了这个动态库，并且工程本身也用到了 <code>SVProgressHUD</code> 库，那么会发生什么？尝试一下，在 Pod 中为 <code>FrameworkTest</code> 添加 <code>SVProgressHUD</code> ,会产生如下的警告：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_1.png?raw=true" alt="重复实现"></p>
<p><code>SVProgressHUD</code> 库中的各个类在工程和库中都进行了实现，但是没有指明使用哪一个实现。不过这个警告，并不影响运行，非强迫症可以选择无视，那么对于强迫症患者，如何消除掉这些警告呢？修改库中 <code>SVProgressHUD</code> 中各个类的命名。有两种方式：手动和自动，将在下面介绍。</p>
<h4 id="动态库引用动态库"><a href="#动态库引用动态库" class="headerlink" title="动态库引用动态库"></a>动态库引用动态库</h4><p>这次被引用的动态库还是 <code>SVProgressHUD</code> 库。先用 pod 下载 <code>SVProgressHUD</code> 的源码，然后打包成动态库，这里就不多做说明了。</p>
<p>将动态库 <code>SVProgressHUD</code> 拖入工程中，新建 <code>DynamicWithDynamic</code> 动态库。将上面的 <code>SVProgress.h</code> 和 <code>SVProgress.m</code> 拖入 <code>DynamicWithDynamic</code> 中，设置暴露出 <code>SVProgress.h</code>。</p>
<p>记得注意一定要在 <code>DynamicWithDynamic</code> 中引入 <code>SVProgressHUD</code> ,如下图所示：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_2.png?raw=true" alt="引入SVProgressHUD"></p>
<p>现在 run 一下，就可以成功生成了。</p>
<p>下面在 <code>FrameworkTest</code> 中测试，使其 embed <code>DynamicWithDynamic</code> 。微调一下 <code>ViewController.m</code> 使其引入目标库，运行。</p>
<p>在运行中出现如下错误：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_3.png?raw=true" alt="错误原因"></p>
<p>这个错误上面也提到过了，是因为必要的动态库没有 embed 进工程中。但是明明已经将 <code>DynamicWithDynamic</code> embed 了啊。好吧，由于 <code>SVProgressHUD</code> 现在是动态库了，还需要将 <code>SVProgressHUD</code> 库 embed 进 <code>FrameworkTest</code> 中。</p>
<p>动态库引入动态库，不会将要引入的动态库打包到自身中，即只是 link 产生关联，而不是 embed 嵌入。 需要在外部使用该动态库时，手动 embed 动态库内要使用的动态库。这样的做法很麻烦，那么有什么意义呢？正如动态库本身的作用，如果工程本身也要用到该 <code>SVProgressHUD</code> 动态库时，那么仅需导入一份，就不会产生重复代码了。</p>
<h4 id="静态库引用静态库"><a href="#静态库引用静态库" class="headerlink" title="静态库引用静态库"></a>静态库引用静态库</h4><p>新建一个 <code>target</code> 命名为 <code>StaticWithStatic</code> ，使用 cocoapods 管理 <code>SVProgressHUD</code> 。基本方法和上面一样，唯一需要改变的地方是 <strong>Mach-O</strong> 需要改为 <strong>Static Library</strong> ，运行。 </p>
<p>然而运行失败，报错如下：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/dynamicstatic_5.png?raw=true" alt="错误原因"></p>
<p>大概意思是在对 <code>ViewController.h</code> 进行链接的时候没有找到 <code>SVProgressHUD.m</code> 。这就很奇怪了，明明已经在 <code>StaticWithStatic</code> 中通过 cocoapods 管理了，怎么会没有 <code>SVProgressHUD.m</code> 呢？我想可能是因为cocoapods只是起到 Link 作用，并没有把第三方库也打进去，那么为什么动态库引入静态库的时候是可行的呢？这就不太清楚了。虽然不知道原因，但是解决方法是有的。需要在工程里，即 <code>FrameworkTest</code> 的 cocoapods 中添加 <code>SVProgressHUD</code>：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">target <span class="string">'DynamicWithStatic'</span> <span class="keyword">do</span></div><div class="line">pod <span class="string">'SVProgressHUD'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">target <span class="string">'StaticWithStatic'</span> <span class="keyword">do</span></div><div class="line">pod <span class="string">'SVProgressHUD'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">target <span class="string">'FrameworksTest'</span> <span class="keyword">do</span></div><div class="line">    pod <span class="string">'SVProgressHUD'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">target <span class="string">'DynamicWithDynamic'</span> <span class="keyword">do</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>再次 build ，错误消除，可以使用。</p>
<h4 id="静态库引用动态库"><a href="#静态库引用动态库" class="headerlink" title="静态库引用动态库"></a>静态库引用动态库</h4><p>静态库貌似不能引用动态库。如果尝试一下，会发现，即使将动态库 <strong>Link Binary With Libraries</strong> 入静态库，也是找不到 <code>SVProgressHUD.h</code> 头文件的。</p>
<h2 id="一些需要知道的点"><a href="#一些需要知道的点" class="headerlink" title="一些需要知道的点"></a>一些需要知道的点</h2><h3 id="debug与release"><a href="#debug与release" class="headerlink" title="debug与release"></a>debug与release</h3><p>库分为 debug 和 release 两种版本。一般来说, 我们应该发布的是 release 版本。</p>
<ul>
<li><strong>debug</strong> :调试版本, 系统本身也会有一些调试代码. 此版本体积会稍大, 运行会稍慢。</li>
<li><strong>release</strong> : 发布版本, 系统会去除调试代码, 体积变小, 运行速度变快. 对用户来说没有明显的感觉。</li>
</ul>
<p>debug 与 release 的设置方式如下图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_1.png?raw=true" alt="debug与release设置"></p>
<p>对于别人给的库，貌似并不能区分是 debug 还是 release 版本的。</p>
<h3 id="多架构编译"><a href="#多架构编译" class="headerlink" title="多架构编译"></a>多架构编译</h3><p>库不仅按 debug 和 release 分类，还会因为运行系统的不同而编译出不同框架的版本。上面的例子都是在真机下的编译，为 arm64 版本，在其他的框架下不能正确运行。</p>
<p>框架分类：</p>
<ul>
<li>模拟器架构: <ul>
<li>i386   : 32位架构  4S ~ 5</li>
<li>x86_64 : 64位架构  5S ~ 现在的机型</li>
</ul>
</li>
<li>真机架构:<ul>
<li>arm7: 在最老的支持iOS7的设备上使用</li>
<li>arm7s: 在iPhone5和5C上使用 </li>
<li>arm64: 运行于iPhone5S的64位 ARM 处理器 上</li>
</ul>
</li>
</ul>
<p>修改框架的方式如下图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_2.png?raw=true" alt="修改框架设置"></p>
<p>debug 项默认为 YES ，表示仅生成当前选择的框架的库； release 项默认为 NO ，表示生成支持所有模拟器或真机的库。生成的库将会保存在 products 目录下的不同分类目录内：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_3.png?raw=true" alt="库所在目录"></p>
<h3 id="lipo"><a href="#lipo" class="headerlink" title="lipo"></a>lipo</h3><p>lipo 是个很有用的命令，主要用来查看库支持的架构以及合并拆分库。</p>
<h4 id="info"><a href="#info" class="headerlink" title="-info"></a>-info</h4><p>查看刚才编译的 Framework 库在 debug 和 release 下支持的框架：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_4.png?raw=true" alt="查看库"><br>可以看到正如上面所说 debug 下不是 fat file ，只支持 arm64 ， release 下是 fat file ， 支持 arm7 和 arm64。</p>
<h4 id="create"><a href="#create" class="headerlink" title="-create"></a>-create</h4><p>上面生成的库，要么是只支持模拟器的，要么是只支持真机的，那么如何才能又能兼顾真机和模拟器呢？ -create 使用方式：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lipo -create 库<span class="number">1</span> 库<span class="number">2</span> -output 新库</div></pre></td></tr></table></figure>
<p>使用结果如下图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_5.png?raw=true" alt="合并"></p>
<h4 id="thin"><a href="#thin" class="headerlink" title="-thin"></a>-thin</h4><p>如果有一个 fat file 但是你不需要支持那么多框架，也可以通过拆分，为库瘦身， -thin 使用方式：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lipo 旧库 -thin 需拆分框架 -output 新库</div></pre></td></tr></table></figure>
<p>使用结果如下图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_6.png?raw=true" alt="拆分"></p>
<h3 id="bundle"><a href="#bundle" class="headerlink" title="bundle"></a>bundle</h3><p>在 framework 中使用 storyboard/xib 创建的页面，可以直接访问 framework 中图片资源。但是 framework 中通过<code>imageNamed：</code>方式加载的照片都会丢失。这是因为 <code>imageNamed:</code>的方法默认是从 <code>mainBundle</code> 中查找资源的，而 framework 中的照片是从 framework 内部加载的，这是的 bundle 并不是 <code>mainBundle</code> ，而是存在于主程序的 docment 文件中的 framework 包，图片加载的路径发生了变化，自然找不到图片资源，所以需要修改加载图片的方法！</p>
<p>一般的方法是创建一个 bundle ：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_7.png?raw=true" alt="创建bundle"></p>
<p>bundle 一般和库命名相同。需要注意的是， bundle 并不会被打包进库中的，而是添加要单独添加到工程中，和 framework 相独立的两部分。向 bundle 中直接添加图片：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_9.png?raw=true" alt="添加图片"></p>
<p>先在主工程的 <strong>Copy Bundle Resources</strong> 中添加 bundle ，如下图所示：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_point_8.png?raw=true" alt="添加bundle"></p>
<p>现在就可以通过<code>[NSBundle mainBundle]</code>获取图片，一下两种方式皆可：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">UIImage</span> imageNamed:[[[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"Frameworks"</span> ofType:<span class="string">@"bundle"</span>] stringByAppendingString:<span class="string">@"/Images/author.png"</span>]]</div><div class="line"></div><div class="line">[<span class="built_in">UIImage</span> imageNamed:<span class="string">@"Frameworks.bundle/Images/author.png"</span>]</div></pre></td></tr></table></figure>
<h2 id="cocoapods打包库"><a href="#cocoapods打包库" class="headerlink" title="cocoapods打包库"></a>cocoapods打包库</h2><p>好了，终于到最后一部分了。前面已经介绍了手动创建库的方式，那么如何自动创建一个库？另外一点，前面提到过，在动态库内引入静态库，会和项目本身由 cocoapods 引入的库同名冲突，如何消除这一冲突？以上问题都可以通过 cocoapods 打包库实现</p>
<h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><p>只需要输入 pod 的 <code>lib</code> 命令即可完成初始项目的搭建:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod lib create StaticWithCocoapods</div></pre></td></tr></table></figure>
<p>输出指令后，会提示确认五个问题，按需求回答即可：</p>
<p><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_1.png?raw=true" alt="创建库"></p>
<p>稍等片刻，就会自动生成一个工程。</p>
<h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><p>在项目目录下有一个 <code>xxx.podspec</code> 配置文件，需要进行修改，摘录如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">Pod::Spec.new do |s|</div><div class="line">  s.name             = &apos;StaticWithCocoapods&apos;</div><div class="line">  s.version          = &apos;0.1.0&apos;</div><div class="line">  s.summary          = &apos;A short description of StaticWithCocoapods.&apos;</div><div class="line"></div><div class="line"># This description is used to generate tags and improve search results.</div><div class="line">#   * Think: What does it do? Why did you write it? What is the focus?</div><div class="line">#   * Try to keep it short, snappy and to the point.</div><div class="line">#   * Write the description between the DESC delimiters below.</div><div class="line">#   * Finally, don&apos;t worry about the indent, CocoaPods strips it!</div><div class="line"></div><div class="line">  s.description      = &lt;&lt;-DESC</div><div class="line">TODO: Add long description of the pod here.</div><div class="line">                       DESC</div><div class="line"></div><div class="line">  s.homepage         = &apos;https://github.com/zhang759740844&apos;</div><div class="line">  s.license          = &#123; :type =&gt; &apos;MIT&apos;, :file =&gt; &apos;LICENSE&apos; &#125;</div><div class="line">  s.author           = &#123; &apos;Zachary&apos; =&gt; &apos;759740844@qq.com&apos; &#125;</div><div class="line">  s.source           = &#123; :git =&gt; &apos;/Users/zachary/Desktop/StaticWithCocoapods&apos;, :tag =&gt; s.version.to_s &#125;</div><div class="line"></div><div class="line">  s.ios.deployment_target = &apos;8.0&apos;</div><div class="line"></div><div class="line">  s.source_files = &apos;StaticWithCocoapods/Classes/**/*&apos;</div><div class="line">  </div><div class="line">  s.resource_bundles = &#123;</div><div class="line">    &apos;StaticWithCocoapods&apos; =&gt; [&apos;StaticWithCocoapods/Assets/*.png&apos;]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  s.public_header_files = &apos;StaticWithCocoapods/Classes/**/*.h&apos;</div><div class="line">  s.frameworks = &apos;UIKit&apos;, &apos;MapKit&apos;</div><div class="line">  s.dependency &apos;AFNetworking&apos;, &apos;~&gt; 2.3&apos;</div><div class="line">  s.denpendency &apos;SVProgressHUD&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>s.version 表示的是当前类库的版本号</li>
<li>s.source 表示当前类库源</li>
<li>s.sources_files 表示类库的源文件存放目录</li>
<li>s.resource_bundles 表示资源文件存放目录</li>
<li>s.frameworks 表示类库依赖的framework</li>
<li>s.dependency 表示依赖的第三方类库</li>
</ul>
<p>其中要说明的是： </p>
<ol>
<li>source 可以填写远端 git 仓库，也可以是像我写的那样的本地 git 仓库。</li>
<li>依赖项不仅要包含你自己类库的依赖，还要包括所有第三方类库的依赖，只有这样当你的类库打包成 .a 或 .framework 时才能让其他项目正常使用。</li>
<li>source_file 路径中出现的通配符 <code>*</code> 表示匹配任意字符， <code>**</code> 表示匹配所有当前文件夹和子文件夹。</li>
<li>source_bundles 中花括号内的 <code>&#39;StaticWithCocoapods&#39;</code> 就表示一个 <code>StaticWithCocoapods</code> bundle。</li>
</ol>
<h3 id="添加文件"><a href="#添加文件" class="headerlink" title="添加文件"></a>添加文件</h3><p>向 <strong>sources_files</strong> 和 <strong>public_header_files</strong> 以及 <strong>resource_bundle</strong> 中添加图片和类文件。在 demo 的文件夹下执行 <code>pod install</code>。现在打开 demo 工程，可以看到创建的 <code>StaticWithCocoapods</code> 库的文件结构如下图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_2.png?raw=true" alt="文件结构"></p>
<p>到这里一切正常，也可以使用 <code>SVProgressHUD</code> ，但是当我想用 <code>[UIImage imageNamed:[[[NSBundle mainBundle] pathForResource:@&quot;StaticWithCocoapods&quot; ofType:@&quot;bundle&quot;] stringByAppendingString:@&quot;/author.png&quot;]]</code> 加载图片资源文件时，一直返回 <code>nil</code> 。</p>
<p>好吧。虽然网上cocoapods打包教程不少，但是真正试过添加图片的人应该不多，最后在 Stackoverflow 的一个评论里总算找到了解决方法<a href="http://stackoverflow.com/questions/25402782/cocoapodsresource-bundle-not-accessbile" target="_blank" rel="external">[Cocoapods]:Resource Bundle not accessbile</a></p>
<p>原先 demo 中 profile 的内容如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">use_frameworks!</div><div class="line"></div><div class="line">target <span class="string">'StaticWithCocoapods_Example'</span> <span class="keyword">do</span></div><div class="line">  pod <span class="string">'StaticW'</span>, <span class="symbol">:path</span> =&gt; <span class="string">'../'</span></div><div class="line"></div><div class="line">  target <span class="string">'StaticWithCocoapods_Tests'</span> <span class="keyword">do</span></div><div class="line">    inherit! <span class="symbol">:search_paths</span></div><div class="line"></div><div class="line">    pod <span class="string">'FBSnapshotTestCase'</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>现在要删除 <code>use_frameworks!</code> 以及其相关内容，变成这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">target <span class="string">'StaticWithCocoapods_Example'</span> <span class="keyword">do</span></div><div class="line">  pod <span class="string">'StaticWithCocoapods'</span>, <span class="symbol">:path</span> =&gt; ‘../‘</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>再次尝试加载图片，可以得到正确结果. ^_^</p>
<h3 id="提交代码"><a href="#提交代码" class="headerlink" title="提交代码"></a>提交代码</h3><ol>
<li>使用 sourcetree 添加本地仓库</li>
<li>提交上面的所有改动</li>
<li>为改动添加 tag 为 <code>0.1.0</code></li>
</ol>
<p>设置好后如图：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_3.png?raw=true" alt="提交代码"></p>
<p>这里要注意，tag 一定要打上，版本控制的时候就是以 tag 来辨别的。</p>
<h3 id="验证类库"><a href="#验证类库" class="headerlink" title="验证类库"></a>验证类库</h3><p>开发完成静态类库之后，需要运行pod lib lint验证一下类库是否符合pod的要求。添加 <code>--allow-warnings</code> 忽略警告：<br><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_4.png?raw=true" alt="验证类库"></p>
<h3 id="打包库"><a href="#打包库" class="headerlink" title="打包库"></a>打包库</h3><p>打包库需要一个 cocoapods 的插件 <strong>cocoapods-packager</strong>来完成类库的打包。</p>
<p>在终端执行以下命令，安装插件：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install cocoapods-packager</div></pre></td></tr></table></figure>
<p>在目标文件夹内执行以下命令，完成打包：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod package StaticWithCocoapods.podspec --force</div></pre></td></tr></table></figure>
<p>打包成 <code>.framework</code> ，也可以用 <code>--library</code> 打包成 <code>.a</code> 。不过 cocoapods 之前有过打包成 <code>.a</code> 但是没有暴露出头文件的bug，懒得试有没有修复了，所以还是都打成 <code>.framework</code> 吧。</p>
<p><img src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/framework_cocoapods_5.png?raw=true" alt="打包过程"></p>
<p>现在在目标文件夹下就会多出一个 <code>StaticWithCocoapods-0.2.0</code> 目录，里面是打包好的 framework 。</p>
<p>至于如何将打包好的库添加到 cocoapods 的官方库内，这个就没有研究了，因为，在很长的一段时间内我都不会用到。有兴趣的可以看看 cocoapods 的官方文档，自行研究下。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://foggry.com/blog/2014/06/12/wwdc2014zhi-iosshi-yong-dong-tai-ku/" target="_blank" rel="external">WWDC2014之iOS使用动态库</a><br><a href="http://blog.csdn.net/lijuan3203/article/details/52105911" target="_blank" rel="external">手把手教你使用CocoaPods打包静态库</a><br><a href="http://www.jianshu.com/p/8f5b9855efb8" target="_blank" rel="external">iOS 静态库开发</a><br><a href="http://www.cnblogs.com/brycezhang/p/4117180.html" target="_blank" rel="external">使用CocoaPods开发并打包静态库</a><br><a href="http://www.cocoachina.com/ios/20150228/11206.html" target="_blank" rel="external">使用Cocoapods创建私有podspec</a><br><a href="https://my.oschina.net/kaqijiang/blog/649632" target="_blank" rel="external">iOS静态库 【.a 和framework】【超详细】</a><br><a href="http://www.samirchen.com/create-a-framework/" target="_blank" rel="external">创建一个 iOS Framework 项目</a><br><a href="http://blog.csdn.net/u013604612/article/details/43197465" target="_blank" rel="external">iOS开发——创建你自己的Framework</a><br><a href="http://chenhuaizhe.com/jekyll/update/2015/12/13/iOS中的workspace与静态库.html" target="_blank" rel="external">iOS中workspace与静态库</a><br><a href="http://www.cocoachina.com/ios/20150906/13323.html" target="_blank" rel="external">Cocoapods 应用第一部分 - Xcode 创建 .framework 相关</a><br><a href="http://www.lhjzzu.com/2016/05/06/static-lib/" target="_blank" rel="external">ios打包–打包静态库(五)</a></p>
<p>呼~总算把库的相关知识看完了，写成这第二篇。花了半个月才总结完。期间各种问题，各种错误不知道怎么解决，真的累。以后还是研究些经常能用得到的东西吧。自己基本不需要打包库<del>~</del></p>
<p><a href="https://github.com/zhang759740844/MyOCDemo/tree/develop/Framework" target="_blank" rel="external">我的demo地址，欢迎参考</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tag/Xcode/" rel="tag">#Xcode</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/10/13/storyboard基础/" rel="next" title="Storyboard 使用方法">
                <i class="fa fa-chevron-left"></i> Storyboard 使用方法
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/01/iOS多线程学习/" rel="prev" title="iOS中的多线程学习笔记">
                iOS中的多线程学习笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://github.com/zhang759740844/MyImgs/blob/master/MyBlog/author.png?raw=true"
               alt="Zachary Zhang" />
          <p class="site-author-name" itemprop="name">Zachary Zhang</p>
          <p class="site-description motion-element" itemprop="description">Less is more</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">58</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://zhang759740844.github.io/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/d6b98b1c1e64/latest_articles" target="_blank" title="JianShu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  JianShu
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概念"><span class="nav-number">1.</span> <span class="nav-text">概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是库"><span class="nav-number">1.1.</span> <span class="nav-text">什么是库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#库的分类"><span class="nav-number">1.2.</span> <span class="nav-text">库的分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#静态库"><span class="nav-number">1.2.1.</span> <span class="nav-text">静态库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态库"><span class="nav-number">1.2.2.</span> <span class="nav-text">动态库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#优劣"><span class="nav-number">1.3.</span> <span class="nav-text">优劣</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#库的创建"><span class="nav-number">2.</span> <span class="nav-text">库的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a静态库的创建"><span class="nav-number">2.1.</span> <span class="nav-text">.a静态库的创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#framework的创建"><span class="nav-number">2.2.</span> <span class="nav-text">.framework的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#动态framework"><span class="nav-number">2.2.1.</span> <span class="nav-text">动态framework</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态framework"><span class="nav-number">2.2.2.</span> <span class="nav-text">静态framework</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#静态库与动态库的引用"><span class="nav-number">2.3.</span> <span class="nav-text">静态库与动态库的引用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#动态库引用静态库"><span class="nav-number">2.3.1.</span> <span class="nav-text">动态库引用静态库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态库引用动态库"><span class="nav-number">2.3.2.</span> <span class="nav-text">动态库引用动态库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态库引用静态库"><span class="nav-number">2.3.3.</span> <span class="nav-text">静态库引用静态库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#静态库引用动态库"><span class="nav-number">2.3.4.</span> <span class="nav-text">静态库引用动态库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一些需要知道的点"><span class="nav-number">3.</span> <span class="nav-text">一些需要知道的点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#debug与release"><span class="nav-number">3.1.</span> <span class="nav-text">debug与release</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多架构编译"><span class="nav-number">3.2.</span> <span class="nav-text">多架构编译</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lipo"><span class="nav-number">3.3.</span> <span class="nav-text">lipo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#info"><span class="nav-number">3.3.1.</span> <span class="nav-text">-info</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#create"><span class="nav-number">3.3.2.</span> <span class="nav-text">-create</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#thin"><span class="nav-number">3.3.3.</span> <span class="nav-text">-thin</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bundle"><span class="nav-number">3.4.</span> <span class="nav-text">bundle</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cocoapods打包库"><span class="nav-number">4.</span> <span class="nav-text">cocoapods打包库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建工程"><span class="nav-number">4.1.</span> <span class="nav-text">创建工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置信息"><span class="nav-number">4.2.</span> <span class="nav-text">配置信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加文件"><span class="nav-number">4.3.</span> <span class="nav-text">添加文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#提交代码"><span class="nav-number">4.4.</span> <span class="nav-text">提交代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证类库"><span class="nav-number">4.5.</span> <span class="nav-text">验证类库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打包库"><span class="nav-number">4.6.</span> <span class="nav-text">打包库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考链接"><span class="nav-number">5.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zachary Zhang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
